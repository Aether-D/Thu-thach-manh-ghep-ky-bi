<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ Ch∆°i Sliding Puzzle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            /* Thay ƒë·ªïi overflow: hidden th√†nh overflow-y: auto ƒë·ªÉ cho ph√©p cu·ªôn d·ªçc khi c·∫ßn thi·∫øt tr√™n m√†n h√¨nh nh·ªè */
            overflow-y: auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        #puzzle-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 0; 
            border: 3px solid #334155;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background-color: #1e293b;
        }

        .puzzle-piece {
            background-size: 400% 400%;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        }
        
        .puzzle-piece:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            z-index: 10;
        }

        .empty-piece {
            background: none;
            cursor: default;
            box-shadow: none;
        }
        
        .empty-piece:hover {
            transform: none;
            box-shadow: none;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            animation: confetti-fall 5s linear infinite;
        }
        .confetti.yellow { background-color: #ff0; }
        .confetti.blue { background-color: #00f; }
        .confetti.green { background-color: #0f0; }
        .confetti.pink { background-color: #f0f; }
        
        /* For suggestion dropdown */
        .suggestion-item:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<!-- C·∫¢I TI·∫æN: Th√™m padding p-4 cho c·∫£ chi·ªÅu d·ªçc v√† ngang -->
<body class="bg-slate-100 flex justify-center min-h-screen p-4">

    <!-- Giao di·ªán 1: Ch√†o m·ª´ng -->
    <div id="welcome-screen" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md text-center transform scale-95 transition-transform duration-300">
            <h2 class="text-3xl font-bold text-slate-800 mb-4">üß© Th·ª≠ th√°ch m·∫£nh gh√©p k·ª≥ b√≠</h2>
            <img src="https://i.postimg.cc/RVMj8C0d/Background-sliding-puzzle.png" alt="Th·ª≠ th√°ch m·∫£nh gh√©p" class="mx-auto rounded-lg mb-6 w-full max-w-sm">
            <button id="next-to-instructions" class="w-full bg-[#F5C45E] text-slate-800 font-bold py-3 px-4 rounded-lg hover:bg-[#E4B351] focus:outline-none focus:ring-4 focus:ring-yellow-400 transition-all duration-300 transform hover:scale-105">K·∫ø ti·∫øp</button>
        </div>
    </div>

    <!-- Giao di·ªán 2: H∆∞·ªõng d·∫´n -->
    <div id="instructions-screen" class="hidden opacity-0 fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md text-center transform scale-95 transition-transform duration-300">
            <h2 class="text-3xl font-bold text-slate-800 mb-4">H∆∞·ªõng d·∫´n tr√≤ ch∆°i</h2>
            <p class="text-slate-600 mb-4 text-lg text-left">H√£y ch·∫°m v√†o c√°c m·∫£nh gh√©p g·∫ßn √¥ tr·ªëng ƒë·ªÉ di chuy·ªÉn n√≥ v·ªÅ ph√≠a √¥ tr·ªëng. Di chuy·ªÉn c√°c m·∫£nh gh√©p sao cho ho√†n thi·ªán b·ª©c ·∫£nh nh∆∞ h√¨nh m·∫´u.</p>
            <img src="https://i.postimg.cc/25bpwH5f/H-ng-d-n.png" alt="H∆∞·ªõng d·∫´n" class="mx-auto rounded-lg mb-6 w-full">
            <button id="next-to-user-info" class="w-full bg-[#F5C45E] text-slate-800 font-bold py-3 px-4 rounded-lg hover:bg-[#E4B351] focus:outline-none focus:ring-4 focus:ring-yellow-400 transition-all duration-300 transform hover:scale-105">K·∫ø ti·∫øp</button>
        </div>
    </div>

    <!-- Giao di·ªán 3: Modal Nh·∫≠p Th√¥ng Tin -->
    <div id="user-info-modal" class="hidden opacity-0 fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300" id="user-info-box">
            <h2 class="text-2xl font-bold text-center text-slate-800 mb-6">Th√¥ng Tin Ng∆∞·ªùi Ch∆°i</h2>
            <form id="user-info-form">
                <div class="mb-4 relative">
                    <label for="department" class="block text-slate-700 font-medium mb-2">B·ªô ph·∫≠n</label>
                    <input type="text" id="department" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required autocomplete="off">
                    <div id="department-suggestions" class="absolute w-full bg-white border border-slate-300 rounded-b-lg mt-0.5 z-20 max-h-48 overflow-y-auto hidden">
                        <!-- Suggestions will be populated by JS -->
                    </div>
                </div>
                <div class="mb-6">
                    <label for="fullName" class="block text-slate-700 font-medium mb-2">H·ªç v√† T√™n</label>
                    <input type="text" id="fullName" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                </div>
                <button id="start-game-btn" type="submit" class="w-full bg-[#F5C45E] text-slate-800 font-bold py-3 px-4 rounded-lg hover:bg-[#E4B351] focus:outline-none focus:ring-4 focus:ring-yellow-400 transition-all duration-300 transform hover:scale-105 disabled:bg-slate-400 disabled:text-white disabled:cursor-not-allowed disabled:hover:scale-100" disabled>B·∫Øt ƒê·∫ßu Ch∆°i</button>
            </form>
        </div>
    </div>

    <!-- Khu v·ª±c tr√≤ ch∆°i -->
    <!-- C·∫¢I TI·∫æN: B·ªè class 'container' ƒë·ªÉ layout b√™n trong c√≥ th·ªÉ d√πng max-width l·ªõn h∆°n -->
    <div id="game-area" class="w-full px-4 sm:px-8 hidden opacity-0 transition-opacity duration-500">
        <!-- C·∫¢I TI·∫æN: Chuy·ªÉn sang layout GRID 2 c·ªôt tr√™n desktop, c√≥ max-width ƒë·ªÉ kh√¥ng b·ªã d√£n qu√° r·ªông -->
        <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12 items-start">
            <!-- C·ªôt 1: H√¨nh ·∫£nh m·∫´u -->
            <div class="w-full flex flex-col items-center text-center">
                <h3 class="text-xl font-semibold text-slate-700 mb-4">H√¨nh ·∫¢nh M·∫´u</h3>
                <!-- C·∫¢I TI·∫æN: TƒÉng max-width c·ªßa ·∫£nh m·∫´u tr√™n desktop -->
                <img id="sample-image" src="https://i.postimg.cc/QNpv1Scw/gia-tri-cot-loi-Toan-Phat.png" alt="H√¨nh M·∫´u" class="rounded-lg shadow-lg mx-auto w-full max-w-md">
                 <!-- C·∫¢I TI·∫æN: Th√™m max-width ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi ·∫£nh -->
                 <div id="player-info" class="mt-4 bg-white p-4 rounded-lg shadow-md text-left w-full max-w-md">
                     <p class="text-slate-800"><strong class="font-semibold">Ng∆∞·ªùi ch∆°i:</strong> <span id="display-fullName"></span></p>
                     <p class="text-slate-800"><strong class="font-semibold">B·ªô ph·∫≠n:</strong> <span id="display-department"></span></p>
                 </div>
            </div>

            <!-- C·ªôt 2: Khu v·ª±c Puzzle -->
            <div class="w-full flex flex-col items-center">
                 <div id="puzzle-wrapper" class="relative w-full flex justify-center">
                      <!-- K√≠ch th∆∞·ªõc puzzle ƒë∆∞·ª£c gi·ªØ nguy√™n, n√≥ s·∫Ω t·ª± l·∫•p ƒë·∫ßy v√†o c·ªôt grid m·ªõi -->
                      <div id="puzzle-container" class="w-full max-w-xs sm:max-w-sm md:max-w-md lg:max-w-lg aspect-square rounded-lg overflow-hidden">
                           <!-- C√°c m·∫£nh gh√©p s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                      </div>
                 </div>
                 <button id="complete-btn" class="mt-6 bg-[#0D1164] text-white font-bold py-3 px-8 rounded-lg hover:bg-[#1F298F] focus:outline-none focus:ring-4 focus:ring-blue-400 transition-all duration-300 transform hover:scale-105 text-lg">Ho√†n Th√†nh</button>
                  <div id="message-box" class="mt-4 text-red-600 font-semibold h-6"></div>
            </div>
        </div>
    </div>
    
    <!-- M√†n h√¨nh ch√∫c m·ª´ng -->
    <div id="win-screen" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0 transition-opacity duration-500">
         <div class="relative w-full h-full overflow-hidden">
             <!-- Confetti container -->
             <div id="confetti-container" class="absolute inset-0"></div>
         </div>
        <div class="bg-white text-center p-10 rounded-2xl shadow-2xl transform scale-75 transition-transform duration-500 relative z-10">
            <i class="fas fa-trophy text-yellow-400 text-7xl mb-4"></i>
            <i class="fas fa-medal text-orange-500 text-6xl mb-4 ml-4"></i>
            <h2 class="text-4xl font-extrabold text-slate-800 mb-4">Tuy·ªát v·ªùi!</h2>
            <p class="text-xl text-slate-600">Ch√∫c m·ª´ng b·∫°n ƒë√£ chi·∫øn th·∫Øng tr√≤ ch∆°i!</p>
             <button id="play-again-btn" class="mt-8 bg-[#F5C45E] text-slate-800 font-bold py-3 px-8 rounded-lg hover:bg-[#E4B351] focus:outline-none focus:ring-4 focus:ring-yellow-400 transition-all duration-300 transform hover:scale-105">Ch∆°i L·∫°i</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const welcomeScreen = document.getElementById('welcome-screen');
            const instructionsScreen = document.getElementById('instructions-screen');
            const userInfoModal = document.getElementById('user-info-modal');
            
            const nextToInstructionsBtn = document.getElementById('next-to-instructions');
            const nextToUserInfoBtn = document.getElementById('next-to-user-info');
            
            const userInfoBox = document.getElementById('user-info-box');
            const userInfoForm = document.getElementById('user-info-form');
            const gameArea = document.getElementById('game-area');
            const puzzleContainer = document.getElementById('puzzle-container');
            const sampleImage = document.getElementById('sample-image');
            const completeBtn = document.getElementById('complete-btn');
            const messageBox = document.getElementById('message-box');
            const winScreen = document.getElementById('win-screen');
            const playAgainBtn = document.getElementById('play-again-btn');
            const displayFullName = document.getElementById('display-fullName');
            const displayDepartment = document.getElementById('display-department');
            
            // --- C·∫£i ti·∫øn √¥ nh·∫≠p li·ªáu B·ªô ph·∫≠n ---
            const departmentInput = document.getElementById('department');
            const departmentSuggestions = document.getElementById('department-suggestions');
            const startGameBtn = document.getElementById('start-game-btn');

            const departmentList = [
                'Ban gi√°m ƒë·ªëc', 'Ban ki·ªÉm so√°t', 'Ph√≤ng k·ªπ thu·∫≠t', 'Ph√≤ng QAQC', 'B·ªô ph·∫≠n kho',
                'Ph√≤ng k·∫ø ho·∫°ch s·∫£n xu·∫•t', 'Ph√≤ng v·∫≠t t∆∞', 'Ph√≤ng xu·∫•t nh·∫≠p kh·∫©u', 'Ph√≤ng k·∫ø to√°n t√†i ch√≠nh',
                'Ph√≤ng h√†nh ch√≠nh nh√¢n s·ª±', 'Ph√≤ng b√°n h√†ng n·ªôi', 'Ph√≤ng b√°n h√†ng xu·∫•t kh·∫©u',
                'Ph√≤ng ph√°t tri·ªÉn h·ªá th·ªëng', 'Ph√≤ng HSE', 'B·ªô ph·∫≠n b·∫£o v·ªá', 'B·ªô ph·∫≠n ƒëi·ªán', 'B·ªô ph·∫≠n c∆° kh√≠',
                'B·ªô ph·∫≠n l√≤ n·∫•u', 'B·ªô ph·∫≠n √©p ph·∫ø', 'B·ªô ph·∫≠n phay - c√°n - k√©o', 'B·ªô ph·∫≠n k√©o th√†nh ph·∫©m',
                'B·ªô ph·∫≠n k√©o ·ªëng th·∫≥ng', 'B·ªô ph·∫≠n lu·ªìn x·ªëp', 'B·ªô ph·∫≠n tang g·ªó', 'B·ªô ph·∫≠n PC - LWC',
                'B·ªô ph·∫≠n l√≤ ·ªß', 'B·ªô ph·∫≠n ƒë√≥ng g√≥i', 'B·ªô ph·∫≠n l√°i xe', 'B·ªô ph·∫≠n t·∫°p v·ª•', 'B·ªô ph·∫≠n b·∫øp'
            ];

            function validateDepartment() {
                const isValid = departmentList.includes(departmentInput.value.trim());
                startGameBtn.disabled = !isValid;
            }

            departmentInput.addEventListener('input', () => {
                const inputText = departmentInput.value.toLowerCase().trim();
                departmentSuggestions.innerHTML = '';

                if (inputText.length > 0) {
                    const filteredDepartments = departmentList.filter(dep => 
                        dep.toLowerCase().includes(inputText)
                    );
                    
                    if (filteredDepartments.length > 0) {
                        filteredDepartments.forEach(dep => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.textContent = dep;
                            suggestionItem.className = 'p-2 cursor-pointer suggestion-item';
                            suggestionItem.addEventListener('click', () => {
                                departmentInput.value = dep;
                                departmentSuggestions.classList.add('hidden');
                                departmentSuggestions.innerHTML = '';
                                validateDepartment();
                            });
                            departmentSuggestions.appendChild(suggestionItem);
                        });
                        departmentSuggestions.classList.remove('hidden');
                    } else {
                        departmentSuggestions.classList.add('hidden');
                    }
                } else {
                    departmentSuggestions.classList.add('hidden');
                }
                validateDepartment();
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', (e) => {
                if (!departmentInput.contains(e.target) && !departmentSuggestions.contains(e.target)) {
                    departmentSuggestions.classList.add('hidden');
                }
            });


            const GRID_SIZE = 4;
            const PIECE_COUNT = GRID_SIZE * GRID_SIZE;
            const IMAGE_SRC = sampleImage.src;

            let pieces = [];
            let emptyIndex = PIECE_COUNT - 1;

            // --- Logic chuy·ªÉn ƒë·ªïi giao di·ªán ---
            
            setTimeout(() => {
                welcomeScreen.querySelector('.transform').style.transform = 'scale(1)';
            }, 100);

            nextToInstructionsBtn.addEventListener('click', () => {
                welcomeScreen.classList.add('opacity-0');
                setTimeout(() => {
                    welcomeScreen.classList.add('hidden');
                    instructionsScreen.classList.remove('hidden');
                    setTimeout(() => {
                        instructionsScreen.classList.remove('opacity-0');
                        instructionsScreen.querySelector('.transform').style.transform = 'scale(1)';
                    }, 50);
                }, 300);
            });
            
            nextToUserInfoBtn.addEventListener('click', () => {
                instructionsScreen.classList.add('opacity-0');
                 setTimeout(() => {
                    instructionsScreen.classList.add('hidden');
                    userInfoModal.classList.remove('hidden');
                    setTimeout(() => {
                        userInfoModal.classList.remove('opacity-0');
                        userInfoBox.style.transform = 'scale(1)';
                    }, 50);
                }, 300);
            });

            userInfoForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const fullName = document.getElementById('fullName').value;
                const department = document.getElementById('department').value;
                
                if (!departmentList.includes(department.trim())) {
                    // This is an extra check, though the button should be disabled anyway.
                    return; 
                }

                displayFullName.textContent = fullName;
                displayDepartment.textContent = department;

                userInfoModal.classList.add('opacity-0');
                userInfoModal.classList.add('pointer-events-none');
                setTimeout(() => {
                    userInfoModal.classList.add('hidden');
                    gameArea.classList.remove('hidden');
                    setTimeout(() => gameArea.classList.remove('opacity-0'), 50);
                    startGame();
                }, 300);
            });
            
            function startGame() {
                createPieces();
                shufflePieces();
                renderBoard();
            }

            function createPieces() {
                pieces = [];
                for (let i = 0; i < PIECE_COUNT; i++) {
                    pieces.push(i);
                }
                emptyIndex = PIECE_COUNT - 1;
            }

            function shufflePieces() {
                let shuffles = 200;
                for (let i = 0; i < shuffles; i++) {
                    const neighbors = getNeighbors(emptyIndex);
                    const randomNeighborIndex = neighbors[Math.floor(Math.random() * neighbors.length)];
                    swapPieces(emptyIndex, randomNeighborIndex);
                    emptyIndex = randomNeighborIndex;
                }
                
                let lastPieceIndex = pieces.indexOf(PIECE_COUNT - 1);
                swapPieces(lastPieceIndex, emptyIndex);
                emptyIndex = lastPieceIndex;
            }

            function renderBoard() {
                puzzleContainer.innerHTML = '';
                const positionStep = 100 / (GRID_SIZE - 1);
                
                for (let i = 0; i < PIECE_COUNT; i++) {
                    const pieceValue = pieces[i];
                    const pieceElement = document.createElement('div');
                    
                    if (pieceValue === PIECE_COUNT - 1) {
                        pieceElement.className = 'puzzle-piece empty-piece';
                    } else {
                        pieceElement.className = 'puzzle-piece';
                        pieceElement.style.backgroundImage = `url(${IMAGE_SRC})`;
                        
                        const col = pieceValue % GRID_SIZE;
                        const row = Math.floor(pieceValue / GRID_SIZE);
                        
                        pieceElement.style.backgroundPosition = `${col * positionStep}% ${row * positionStep}%`;
                        pieceElement.dataset.index = i;
                    }
                    puzzleContainer.appendChild(pieceElement);
                }
            }

            puzzleContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('puzzle-piece') && !e.target.classList.contains('empty-piece')) {
                    const clickedIndex = parseInt(e.target.dataset.index);
                    const neighbors = getNeighbors(emptyIndex);

                    if (neighbors.includes(clickedIndex)) {
                        swapPieces(clickedIndex, emptyIndex);
                        emptyIndex = clickedIndex;
                        renderBoard();
                    }
                }
            });

            function getNeighbors(index) {
                const neighbors = [];
                const row = Math.floor(index / GRID_SIZE);
                const col = index % GRID_SIZE;

                if (row > 0) neighbors.push(index - GRID_SIZE);
                if (row < GRID_SIZE - 1) neighbors.push(index + GRID_SIZE);
                if (col > 0) neighbors.push(index - 1);
                if (col < GRID_SIZE - 1) neighbors.push(index + 1);
                
                return neighbors;
            }

            function swapPieces(index1, index2) {
                [pieces[index1], pieces[index2]] = [pieces[index2], pieces[index1]];
            }

            completeBtn.addEventListener('click', () => {
                if (isSolved()) {
                    const completionTime = new Date();
                    const data = {
                        timestamp: completionTime.toLocaleString('vi-VN', { timeZone: 'Asia/Ho_Chi_Minh' }),
                        fullName: displayFullName.textContent,
                        department: displayDepartment.textContent,
                    };
                    sendDataToGoogleSheet(data);
                    showWinScreen();
                } else {
                    messageBox.textContent = 'Ch∆∞a ƒë√∫ng. C·ªë g·∫Øng l√™n b·∫°n nh√©!';
                    setTimeout(() => { messageBox.textContent = ''; }, 2000);
                }
            });

            function sendDataToGoogleSheet(data) {
                const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxZaPuw7kUToZnflTqRsDJLYBZiUeSXOM0ZkMFYiAJA4elyxcjyFiNZKeK_YY1nWDxS/exec";
                
                const formData = new FormData();
                // C·∫¢I TI·∫æN: ƒê·ªïi t√™n c√°c tr∆∞·ªùng d·ªØ li·ªáu ƒë·ªÉ kh·ªõp v·ªõi Google Sheet (th∆∞·ªùng l√† ti√™u ƒë·ªÅ c·ªôt)
                formData.append('Timestamp', data.timestamp);
                formData.append('H·ªç v√† T√™n', data.fullName);
                formData.append('B·ªô ph·∫≠n', data.department);

                // C·∫¢I TI·∫æN: B·ªè 'mode: no-cors' v√† th√™m x·ª≠ l√Ω l·ªói chi ti·∫øt
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                })
                .then(response => {
                    // response.ok s·∫Ω l√† true n·∫øu status code l√† 200-299
                    if (response.ok) {
                        // Th∆∞·ªùng th√¨ Google Script s·∫Ω tr·∫£ v·ªÅ m·ªôt chu·ªói ho·∫∑c JSON
                        return response.text(); 
                    }
                    // N·∫øu kh√¥ng, n√©m ra l·ªói ƒë·ªÉ .catch() c√≥ th·ªÉ b·∫Øt ƒë∆∞·ª£c
                    throw new Error(`L·ªói m·∫°ng: ${response.statusText}`);
                })
                .then(data => {
                    console.log('G·ª≠i d·ªØ li·ªáu th√†nh c√¥ng!', data);
                    // B·∫°n c√≥ th·ªÉ th√™m m·ªôt th√¥ng b√°o cho ng∆∞·ªùi d√πng ·ªü ƒë√¢y n·∫øu c·∫ßn
                })
                .catch(error => {
                    console.error('L·ªói khi g·ª≠i d·ªØ li·ªáu:', error);
                    // Hi·ªÉn th·ªã l·ªói cho ng∆∞·ªùi d√πng ho·∫∑c trong messageBox
                    messageBox.textContent = 'G·ª≠i k·∫øt qu·∫£ th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.';
                });
            }

            function isSolved() {
                for (let i = 0; i < PIECE_COUNT; i++) {
                    if (pieces[i] !== i) {
                        return false;
                    }
                }
                return true;
            }
            
            function showWinScreen() {
                 winScreen.classList.remove('hidden');
                 createConfetti();
                 setTimeout(() => {
                     winScreen.classList.remove('opacity-0');
                     const winBox = winScreen.querySelector('.bg-white');
                     if (winBox) {
                        winBox.classList.remove('scale-75');
                        winBox.classList.add('scale-100');
                     }
                 }, 50);
            }
            
            playAgainBtn.addEventListener('click', () => {
                winScreen.classList.add('opacity-0');
                const winBox = winScreen.querySelector('.bg-white');
                if (winBox) {
                    winBox.classList.add('scale-75');
                }
                 setTimeout(() => {
                     winScreen.classList.add('hidden');
                     document.getElementById('confetti-container').innerHTML = '';
                     startGame();
                 }, 500);
            });
            
            function createConfetti() {
                const container = document.getElementById('confetti-container');
                container.innerHTML = '';
                const colors = ['yellow', 'blue', 'green', 'pink'];
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = `confetti ${colors[Math.floor(Math.random() * colors.length)]}`;
                    confetti.style.left = `${Math.random() * 100}vw`;
                    confetti.style.animationDelay = `${Math.random() * 5}s`;
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    container.appendChild(confetti);
                }
            }
        });
    </script>
</body>
</html>

